# 题目生成器需求文档

## 背景和目标

四则运算能力是小学生数学能力的一部分, 要对其进行提高, 大量的练习是不可或缺的. 然而不同年龄阶段、不同成绩水平的小学生对于四则运算题目的要求不同, 编写对应的习题以及批阅这些习题是一项繁琐枯燥的任务, 因此我们发起这个项目以期解决这些问题.

## 用户画像及使用场景

### 用户画像

产品的用户主要是家长和老师, 用户群体中大部分具有基本的计算机操作技能, 但也有比例不小的用户缺乏相关技能.

基于<a href="http://gsa.statcounter.com/">StatCounter</a>的统计结果, 大部分用户使用的操作系统为 Windows 7、Android 8 及以上版本, 浏览器内核为 Chromium 57、Gecko 52 及以上版本.

### 使用场景

产品的主要使用场景为老师为学生布置作业, 或家长为孩子布置作业, 以及完成作业后的批阅.

对于习题, 有直接在屏幕上阅读和打印成纸质练习阅读两种场景.

## 功能需求

现有要求如下: 

```
1 使用参数控制生成题目的个数
2 使用参数控制题目中数值（自然数、真分数和真分数分母）的范围
3 使用参数控制题目中是否带括号
4 生成的题目中如果存在形如 e1 ÷ e2 的子表达式，那么其结果应是真分数
5 每道题目中出现的运算符个数不超过 3 个
6 程序一次运行生成的题目不能重复，请思考关于重复的定义。生成的题目存入执行程序的当前目录下的Exercises.txt文件，格式如下：
    1. 四则运算题目1
    2. 四则运算题目2

7 在生成题目的同时，计算出所有题目的答案，并存入执行程序的当前目录下的Answers.txt文件，格式如下：
    1. 答案1
    2. 答案2

8 程序支持对给定的题目文件和答案文件，判定答案中的对错并进行数量统计，并会输出所有题目中重复的题目，统计结果输出到文件Grade.txt，格式如下：
        Correct: 5 (1, 3, 5, 7, 9)
        Wrong: 5 (2, 4, 6, 8, 10)
        Repeat:2
        RepeatDetail:
        (1)   2,45+32  Repeat 3,32+45                   
        (2)   5,3+(2+1)  Repeat 7,1+2+3

…………实用软件可能会用到的其他功能模块……
```

基于这些要求, 我们做出以下约定: 

### 约定

#### 运算和运算数

对于运算, 只支持 **加(`+`)、减(`-`)、乘(`*`)、除(`/`)**

对于运算数, 只有 **整数** 和 **分数** 两种, 其中, 作为运算数的分数只能是真分数

#### 分数表示

为了便于表示, 在此, 我们对分数做出以下约定:

+ 分数前加 `_`, 以 `~` 代替 `/` 从而与除法进行区分

+ 带分数在整数部分与分数部分间用 `U` 连接

示例:

> `_1~2` 读作 **二分之一**

> `15U_1~2` 读作 **十五又二分之一**

#### 范围比较

我们约定: 设置的范围是针对整个运算过程的, 即: 不论是**运算数**、运算过程中产生的**中间数**还是**最终结果**, 均应在设定的范围内.

在此对分数进行特殊约定: 不判断通分过程中产生的数字是否满足范围要求, 仅对 **运算结果** 进行判断.

若运算产生了假分数, 则将其转换为带分数形式, 对 **整数部分** 和 **分数部分** 分别进行范围判断.

#### 重复的定义

采用表达式树判定, 即两个表达式的表达式树能通过交换左右子树相互转换即认定为重复.

### 具体功能

由于用户群体的特点, 产品必须简单易用, **不能出现**复杂的配置过程, 同时应该**尽量减少**弹窗, 对于错误输入也应该**指出正确做法**.

此外考虑到阅读的便利性, 对于分数的显示以及打印文档也应当纳入考虑范围内.

因此, 我们将图形界面和打印功能作为扩展功能, 在主体功能完成后进行设计、实现.

综上, 我们归纳出以下的功能点:

| 功能 | |
| :--: | :-- |
| 设置 | 题目数量、数值范围、题目难度 |
| 内容生成 | 生成题目与答案, 并保存文件 |
| 自动阅卷 | 批阅答案对错并查找重复习题 |
| 图形界面<sub>(扩展)</sub> | |
| 打印习题<sub>(扩展)</sub> | |

扩展部分将在主体功能实现后进行讨论, 形成补充设计文档, 此处不谈.

### 设置

以参数形式对每个设置项进行设置, 包括:

1. 题目的数量

2. 题目中数值的范围: 整数的最小值与最大值, 分母的最大值

3. 可以使用的运算符 **加(`+`)、减(`-`)、乘(`*`)、除(`/`)** 以及能否使用括号

4. 运算符的个数

### 内容生成

1. 生成指定数量的合法且无重复项的习题集

2. 给出答案

3. 输出到文件

### 自动阅卷

1. 读入文件

2. 对习题进行计算, 与输入的答案进行比较, 输出错误的题号

3. 由习题生成表达式树, 进行重复项的查找

4. 输出阅卷结果

## 设计思路

由功能要点可知, 主要的工作集中在习题的合法性判断、计算和去重中.

### 合法性判断

合法性判断主要是对数值范围的判断, 由于生成机制的限制, 难以在生成阶段实现完备的合法性判断, 因此, 还需要在运算阶段进行合法性判断.

### 计算

由于计算比较复杂, 涉及到分数、整数及混合运算, 难以直接计算, 此处采用将中缀表达式转换成 **后缀表达式** 后再进行计算.

### 去重

以特定规则建立表达式树, 若生成的表达式树相等, 即认定重复.

## 验收列表

| 功能需求 | 是否实现 |
| :--: | :-- |
| 可以设置题目数量 | |
| 可以设置运算符数量 | |
| 可以设置运算符 | |
| 可以设置是否有括号 | |
| 可以设置是否有分数(运算数) | |
| 可以在10s内生成1000道题目 | |
| 可以批改阅卷 | |
| 生成文件中不存在重复项 | |
| 批改中不存在批改错误 | |